<project name="Portable" default="convert" basedir="." xmlns:if="ant:if" xmlns:unless="ant:unless" xmlns:dn="antlib:org.apache.ant.dotnet" xmlns="antlib:org.apache.tools.ant">

	<description>Conversion from ;ava to C# using JavaToCSharp</description>
  
	<import file="build-convert.xml"/>

  <target name="clone" description="Gets the JavaToCSharp converter (from forked branch)">
    <runClone />
  </target>

  <target name="convert" description="Perform the conversion and the required postprocessing">
    <runConvert input="../java/src/main/java/giis/portable/xml/tiny" output="Portable/Translated/Giis.Portable.Xml.Tiny" />
    <delete file="Portable/Translated/Giis.Portable.Xml.Tiny/XNode.cs" />
    <delete file="Portable/Translated/Giis.Portable.Xml.Tiny/XmlException.cs" />

    <runConvert input="../java/src/test/java/giis/portable" output="PortableTest/Translated/Giis.Portable" mapping="java-mappings.yml" />

    <replace dir=".">
      <include name="Portable*/Translated/**/*" />
      <replacefilter token="using converted.placeholder;" value="/////// THIS FILE HAS BEEN AUTOMATICALLY CONVERTED FROM THE JAVA SOURCES. DO NOT EDIT ///////" />
      <!-- nunit requires the exact exception in assert throws, allows derived types -->
      <replacefilter token="Assert.Throws(typeof(Exception)" value="Assert.Throws(Is.InstanceOf(typeof(Exception))" />

      <!-- Replacement to handle maps (implementations are in the Java.Util namespace) -->
      <replacefilter token="Dictionary&lt;" value="Map&lt;" />
    </replace>
  </target>

</project>